Log: Supabase*DB_API*전체*연동*및*기능*구현
Date: 2025-12-26 08:12:16
Key Goal: 기존 localStorage 기반의 VibeFolio 웹 애플리케이션을 Supabase 데이터베이스와 REST API 기반으로 전면 전환하고, 핵심 기능(인증, 프로젝트 관리, 소셜 기능 등)을 구현 및 연동 완료.

📝 상세 작업 일지 (Chronological)

1. Supabase 데이터베이스 스키마 설계 및 적용
   상황: 프로젝트 시작 시 데이터 저장을 위한 DB 구조가 필요함.
   해결:

- `supabase/schema.sql`: 9개 테이블(`User`, `Project`, `Category`, `Like`, `Wishlist`, `Comment`, `Proposal`, `OutsourcingRequest`, `JobPosting`) 정의.
- 인덱스, `updated_at` 트리거, RLS(Row Level Security) 정책 포함.
- 실제 Supabase 대시보드에서 SQL Editor를 통해 테이블 생성 완료.
  기술적 포인트: PostgreSQL 기반 스키마 설계, RLS 정책 수립.

2. 인증 시스템 구축 (User 테이블 기반)
   상황: Supabase Auth 대신 커스텀 `User` 테이블을 사용한 인증 요구.
   해결:

- `/api/auth/signup/route.ts`: 회원가입 API 구현. Supabase Auth 대신 `User` 테이블에 직접 Insert. 비밀번호는 `bcrypt`로 해시화 저장.
- `/api/auth/login/route.ts`: 로그인 API 구현. 이메일/비밀번호 검증 후 사용자 정보 반환.
- `src/app/signup/page.tsx`, `src/app/login/page.tsx`: 프론트엔드 로직을 Supabase SDK(`auth.signUp`) 호출에서 API 호출(`fetch`)로 변경.
- RLS 문제 해결: `supabase-js` 클라이언트의 권한 문제로 인해 `SUPABASE_SERVICE_ROLE_KEY`를 사용하는 `supabaseAdmin` 클라이언트(`src/lib/supabase/client.ts`)를 별도로 생성하여 백엔드 로직에서 사용.

3. 프로젝트 관리 기능 (Project API)
   상황: 프로젝트 목록, 상세, 업로드 기능을 로컬 스토리지에서 DB로 이관 필요.
   해결:

- `/api/projects/route.ts`: 프로젝트 목록 조회(GET) 및 생성(POST) API. 검색 필터(제목, 내용, 카테고리) 및 페이지네이션 지원.
- `/api/projects/[id]/route.ts`: 단일 프로젝트 상세 조회, 수정, 삭제 API.
- `src/app/page.tsx`: 메인 페이지 프로젝트 로딩 로직 변경.
- `src/app/project/upload/page.tsx`: 이미지 업로드 및 프로젝트 등록 로직 API 연동.
- `src/app/project/[id]/page.tsx`: 상세 페이지 데이터 로딩 로직 변경.
- 마이그레이션: `is_deleted` 컬럼 추가 및 소프트 삭제 로직 구현.

4. 인터랙션 기능 구현 (Like, Comment, Wishlist)
   상황: 좋아요, 댓글, 북마크 기능이 로컬 스토리지로만 동작.
   해결:

- `/api/likes/route.ts`: 좋아요 토글 및 카운트 조회 API.
- `/api/comments/route.ts`: 댓글 작성, 조회, 삭제(소프트 삭제) API. `User` 테이블 정보를 조인하여 작성자 정보 함께 반환.
- `/api/wishlist/route.ts`: 북마크 토글 및 조회 API.
- 상세 페이지(`project/[id]`)에서 각 버튼 클릭 시 해당 API 호출하도록 핸들러 수정.

5. 이미지 업로드 (Supabase Storage)
   상황: 프로젝트 썸네일을 Base64 문자열로 저장하여 DB 용량 문제 발생 가능성.
   해결:

- Supabase Storage에 `project-images` 버킷 생성.
- `src/lib/supabase/storage.ts`: 이미지 업로드 및 삭제 유틸리티 함수 구현.
- 업로드 페이지에서 이미지 선택 시 Storage에 업로드하고 반환된 공개 URL을 DB에 저장하도록 변경.

6. 마이페이지 및 검색 기능 강화
   상황: 사용자 프로필 관리 및 프로젝트 검색 기능 필요.
   해결:

- `/api/users/[id]/route.ts`: 프로필 조회 및 수정 API.
- `/api/users/[id]/projects/route.ts`: 특정 사용자가 올린 프로젝트 목록 조회 API.
- `src/app/mypage/profile/page.tsx`: 프로필 조회/수정 로직 API 연동.
- `src/app/search/SearchPageContent.tsx`: 검색어 입력 시 `/api/projects?search=...` 호출하여 결과 렌더링.

7. 트러블슈팅 및 안정화
   상황: 로그인 실패, API 500 에러, 포트 충돌 등 다양한 이슈 발생.
   해결:

- "Invalid login credentials" 이슈: bcrypt 해시 생성 스크립트(`scripts/create-test-user.js`) 작성 및 테스트 계정 비밀번호 재설정.
- Supabase 관계 오류: API에서 조인 쿼리 작성 시 명시적 관계(`User!Project_user_id_fkey`) 지정으로 해결.
- 포트 충돌: 4000번 포트 점유 프로세스 종료 후 개발 서버 재시작.
- 디버깅: API 및 프론트엔드 곳곳에 로그(`console.log`)를 추가하여 데이터 흐름 추적.
