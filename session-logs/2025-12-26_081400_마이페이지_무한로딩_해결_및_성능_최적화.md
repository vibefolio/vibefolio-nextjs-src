Log: 마이페이지 무한로딩 해결 및 성능 최적화
Date: 2025-12-26 08:14:00
Key Goal: 마이페이지의 무한 로딩 버그 수정, UI/UX 통합, 좋아요 탭 오류 해결 및 웹 애플리케이션 전반의 성능 최적화

📝 상세 작업 일지 (Chronological)

1. 마이페이지 "내 프로젝트" 탭 UI 통합 및 메뉴 정리
   상황: 사용자가 "내 프로젝트" 별도 페이지의 기능(카드 UI, 삭제 등)을 마이페이지 탭 내부로 통합하고 싶어함. 또한 헤더의 중복 메뉴 제거 요청.
   해결:

- src/app/mypage/page.tsx: `activeTab === 'projects'` 영역에 `mypage/projects/page.tsx`의 카드 그리드 레이아웃과 삭제/보기 로직을 이식.
- src/components/AuthButtons.tsx: 헤더 아바타 드롭다운에서 불필요해진 "나의 프로젝트" 메뉴 항목 삭제 및 관련 아이콘 import 정리.
- lint 수정: 누락된 Lucide 아이콘(`Eye`, `Trash2`) import 추가 및 중복 렌더링 코드 제거.

2. 마이페이지 무한 로딩(Infinite Loop) 버그 수정
   상황: 마이페이지 진입 시 지속적인 로딩 스피너가 돌거나 데이터 요청이 무한 반복되는 현상 발생.
   해결:

- src/app/mypage/page.tsx:
  - 원인 분석: `useEffect`의 의존성 배열에 계속 변경되는 객체(`userProfile`, `collections`)가 포함되어 리렌더링 루프 발생.
  - 리팩토링: 복잡한 `useCallback`을 제거하고, `initialization`(유저 정보 로드)과 `data fetching`(탭 데이터 로드) 로직을 분리하여 의존성을 단순화함 (`userId`, `activeTab`만 의존).
  - 상태 관리: `initialized` 플래그를 도입하여 초기 데이터 로드 전 불필요한 fetch 방지.

3. 좋아요 탭 렌더링 오류 수정
   상황: "좋아요" 탭 클릭 시 `ImageCard` 컴포넌트 내부에서 `cannot read properties of undefined` 오류 발생.
   해결:

- src/components/ImageCard.tsx:
  - Props 데이터 구조의 불일치로 인한 Null Access 오류 확인.
  - Optional Chaining (`?.`) 및 Fallback 값(`||`)을 모든 데이터 접근 지점에 적용하여 안전성 강화.
  - `props.user.profile_image.large` 접근 시 `props.user`가 없어도 에러가 나지 않도록 수정.

4. 웹 성능 최적화 및 빌드 안정화
   상황: 전반적인 로딩 속도 개선 및 불필요한 코드/페이지 정리 요청.
   해결:

- next.config.ts:
  - 이미지 최적화 설정 추가 (AVIF/WebP 포맷, 캐시 TTL 7일).
  - `experimental.optimizePackageImports` 설정으로 `lucide-react` 등 아이콘 라이브러리 트리쉐이킹 최적화.
  - 정적 자산(이미지, JS)에 1년 캐시 헤더(`Cache-Control`) 적용.
  - 중복 페이지(`mypage/likes`, `mypage/bookmarks`)를 `/mypage`로 리다이렉트 처리.
- src/app/api/projects/route.ts:
  - 쿼리 최적화: `select(*)` 대신 필요한 필드만 명시적으로 조회하여 페이로드 감소.
  - 병렬 처리: 사용자 정보 조회 시 `Promise.all`을 사용하여 병렬로 데이터 fetching.
  - 캐싱: API 응답 헤더에 `s-maxage=60, stale-while-revalidate=300` 추가.
  - 페이지네이션: `limit`, `page` 파라미터를 활용한 Supabase `range` 쿼리 적용.
- 검증: `npm run build`를 통해 타입스크립트 오류 없음 및 빌드 성공 확인.
